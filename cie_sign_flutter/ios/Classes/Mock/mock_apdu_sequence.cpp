#include "mock_apdu_sequence.h"

static const MockApduFixture kMockFixture = []{
    MockApduFixture fixture;
    fixture.description = "Minimal mock sequence for PKCS#7 signing";
    fixture.atr = {'M','O','C','K'};
    fixture.exchanges = {
        // Select IAS
        {{0x00,0xA4,0x04,0x00,0x07,0xA0,0x00,0x00,0x00,0x30,0x80,0x00},
         {0x90,0x00}},
        // Select CIE
        {{0x00,0xA4,0x04,0x00,0x06,0xA0,0x00,0x00,0x00,0x00,0x39},
         {0x90,0x00}},
        // Read certificate (truncated)
        {{0x00,0xB0,0x00,0x00,0x00},
         {0x30,0x82,0x01,0x00,0x90,0x00}},
        // Verify PIN
        {{0x00,0x20,0x00,0x81,0x04,'1','2','3','4'},
         {0x90,0x00}},
        // Set key
        {{0x00,0x22,0x41,0xA4,0x04,0x80,0x02,0x84,0x81},
         {0x90,0x00}},
        // Sign (digest info placeholder -> signature placeholder)
        {{0x00,0x88,0x00,0x00,0x10,0x30,0x0D,0x06,0x09,0x60,0x86,0x48,0x01,0x65,0x03,0x04,0x02,0x01,0x05,0x00,0x04,0x00},
         {0x30,0x30,0x90,0x00}}
    };
    fixture.exchanges.clear(); // mock mode bypasses APDU transport
    return fixture;
}();

const MockApduFixture& get_mock_fixture() {
    return kMockFixture;
}
